[{"name":"app.R","content":"\nlibrary(shiny)\n\n# Define UI for the app\nui <- fluidPage(\n  titlePanel(HTML(\"<h1>Ablated Female Shrimp Calculator<\/h1><p>\n                  This app calculates the estimated number of ablated female \n                  breeder shrimp that would be used to produce an inputted tonnage of shrimp.<\/p>\")\n  ),\n  sidebarLayout(\n    sidebarPanel(\n      numericInput(\"tonnes\", \"Metric Tonnes of Shrimp Produced:\", value = 500, min = 0),\n      selectInput(\"species\", \"Species\", c(\"P. vannamei\",\n                                          \"P. monodon\", \"Other penaeid species\")),\n      sliderInput(\"mortality_rate\", \"Pre-slaughter Mortality Rate (%):\", \n                  min = 0, max = 100, value = 50, step = 1),\n      sliderInput(\"hatching_rate\", \"Hatching Rate (%):\", \n                  min = 0, max = 100, value = 50, step = 1),\n      sliderInput(\"ablation_rate\", \"What percentage of female shrimp are ablated?:\", \n                  min = 0, max = 100, value = 100, step = 1),\n      actionButton(\"calculate\", \"Calculate\")\n    ),\n    mainPanel(\n      HTML(\"<h3>Number of Female Breeder Shrimp Needed:<\/h3>\"),\n      tags$div(\n        class = \"output-summary\",\n        tags$p(\"Mean Estimate:\", span(textOutput(\"mean_result\", container = span),\n                                      style = \"font-size: 30px; font-weight: bold\"),\n               style = \"font-size: 25px;\", \"shrimp\"),\n        tags$p(\"5th Percentile:\", span(textOutput(\"p5_result\", container = span),\n                                       style = \"font-size: 20px; font-weight: bold\"),\n                                       style = \"font-size: 15px;\", \"shrimp\"),\n        tags$p(\"95th Percentile:\", span(textOutput(\"p95_result\", container = span), \n                                        style = \"font-size: 20px; font-weight: bold;\"),\n               style = \"font-size: 15px;\", \"shrimp\")\n      ),\n      tags$footer(\n        HTML(\"<p style='font-size: 12px; color: #666;'>\n          <br><br><br>Info: The calculation first converts tonnages to number of individuals,\n          then estimates how many females would be needed to produce that number of individuals\n          while accounting for pre-slaughter mortality and hatching rate. 100,000 estimates\n          based on possible weight and egg number ranges, then the mean, 5th percentile,\n          and 95th percentile are reported.<br> <br>\n          Egg numbers are estimated from the FAO factsheets for P. vannamei and P. monodon,\n          and Table 4.6a in Wickins and Lee (2002). Average shrimp weight is based on\n          estimates by fishcount.\n        <\/p>\")\n    )\n  )\n))\n\n# Define server logic for the app\nserver <- function(input, output) {\n  \n  calculate_breeders <- reactive({\n    set.seed(123) # Set seed for reproducibility\n    \n    tonnes <- input$tonnes\n    mortality_rate <- input$mortality_rate / 100\n    hatching_rate <- input$hatching_rate / 100\n    ablation_rate <- input$ablation_rate / 100\n    num_samples <- 100000 # Number of samples for shrimp weight and eggs per female\n    \n    # Define average shrimp weight ranges for each species\n    shrimp_weight_ranges <- list(\n      \"P. vannamei\" = list(mean = 18, sd = (26 - 11) / 4),\n      \"P. monodon\" = list(mean = 37, sd = (60 - 20) / 4),\n      \"Other penaeid species\" = list(mean = 18, sd = (40 - 6) / 4)\n    )\n    \n    # Random sampling of shrimp weights based on selected species\n    species_data <- shrimp_weight_ranges[[input$species]]\n    average_shrimp_weight <- rnorm(num_samples, mean = species_data$mean, sd = species_data$sd)\n    average_shrimp_weight <- average_shrimp_weight[average_shrimp_weight > 0] # Ensure no negative weights\n    \n    # Convert tonnes to grams (assuming 1 tonne = 1,000,000 grams)\n    total_shrimp_grams <- tonnes * 1e6\n    \n    # Total number of shrimp needed\n    total_shrimp_needed <- total_shrimp_grams / average_shrimp_weight\n    \n    # Adjust for preslaughter mortality\n    total_shrimp_needed_adjusted <- total_shrimp_needed / (1 - mortality_rate)\n    \n    # Adjust for hatching rate\n    total_shrimp_needed_adjusted <- total_shrimp_needed_adjusted / hatching_rate\n    \n    # Define egg ranges for each species\n    egg_ranges <- list(\n      \"P. vannamei\" = c(100000, 250000),\n      \"P. monodon\" = c(500000, 750000),\n      \"Other penaeid species\" = c(200000, 1000000)\n    )\n    \n    # Get the appropriate egg range for the selected species\n    eggs_per_female_range <- egg_ranges[[input$species]]\n    \n    # Randomly sample egg numbers from the uniform range for the selected species\n    eggs_per_female_samples <- runif(num_samples, min = eggs_per_female_range[1], max = eggs_per_female_range[2])\n    \n    # Number of female breeders needed\n    breeders_needed <- total_shrimp_needed_adjusted / eggs_per_female_samples\n    \n    breeders_needed <- breeders_needed * ablation_rate\n    \n    # Calculate mean, 5th percentile, and 95th percentile\n    mean_estimate <- mean(breeders_needed)\n    p5_estimate <- quantile(breeders_needed, probs = 0.05)\n    p95_estimate <- quantile(breeders_needed, probs = 0.95)\n    \n    list(\n      mean_estimate = mean_estimate,\n      p5_estimate = p5_estimate,\n      p95_estimate = p95_estimate,\n      shrimp_weights = average_shrimp_weight,\n      num_samples = length(breeders_needed)\n    )\n  })\n  \n  output$mean_result <- renderText({\n    res <- calculate_breeders()\n    ceiling(res$mean_estimate)\n  })\n  \n  output$p5_result <- renderText({\n    res <- calculate_breeders()\n    ceiling(res$p5_estimate)\n  })\n  \n  output$p95_result <- renderText({\n    res <- calculate_breeders()\n    ceiling(res$p95_estimate)\n  })\n}\n\n# Run the app\nshinyApp(ui = ui, server = server)\n","type":"text"}]
